 



第 1 章　什么是JSON

1.　JSON是一种数据交换格式，数据交换格式是一种在不同平台间传递数据的文本格式。

2.　JSON独立于编程语言，JSON 的全称是 JavaScript Object Notation（JavaScript 对象表示法）。

表示法是指一个可以表示诸如数字或单词等数据的字符系统。不管你是否理解什么是对象，都不难看出用某个符号去描述编程语言中共有概念的价值所在。

可移植性，或者说在平台和系统间传输信息的兼容性，是一种数据交换格式所追求的一个重要指标。

 JSON 不仅独立于语言，而且使用了一种在许多编程语言中都能找到共同元素的表达方式。通过这种表达数据的方式，即便是那些不支持面向对象编程的语言，也会发现 JSON 这种格式是可以接受的。



第 2 章　JSON语法

2.3　正确的JSON语法

JSON 中的名称 - 值对是一种对许多系统都十分友好的数据结构，而使用空格和特殊字符（即 a~z、0~9 除外的其他字符）忽略了可移植性。

为了获得最大可移植性，应尽可能避免使用空格或特殊字符。

JSON 中的名称 - 值对的名称如果被系统作为对象装入内存的话，将会成为属性。

当值是字符串时，必须使用双引号。而在 JSON 中，还有数字、布尔值、数组、对象、null 等其他数据类型，这些都不应被双引号包裹。



第 3 章　JSON的数据类型

3.3　JSON中的对象数据类型

JSON 中的对象类型非常简单。追根溯源，JSON 本身就是对象，也就是一个被花括号包裹的名称 - 值对的列表。



3.4　JSON中的字符串类型

反斜线会告诉解析器这个双引号并不意味着字符串的结束。一旦解析器将字符串装入内存，每一个双引号前的反斜线都会被移除，文本也会按预期输出。



3.9　专业术语和概念

JSON 中的字符串类型：一个字符串值，如 my string，使用双引号包裹。

JSON 中的数字类型：一个数字值，如 42，可以是正整数、负整数、小数或指数。

JSON 中的数组类型：数组是值的集合或列表，每个值都可以是字符串、数字、布尔值、对象或数组中的任何一种，数组必须被方括号（[]）包裹，且值与值之间用逗号隔开。

JSON 中的对象类型：对象类型是使用逗号分隔的名称 - 值对构成的集合，并使用花括号（{}）包裹。

JSON 中布尔类型的值只有 true 和 false，且所有字母必须小写（即 true，不能是 True 或 TRUE）。

JSON 中的 null 值的所有字母必须小写（即 null，不能是 NULL 或 Null）。



对象和数组很关键的一个区别就是，对象是名称 - 值对构成的列表或集合，数组是值构成的列表或集合。

对象和数组另一个关键的区别是，数组中所有的值应具有相同的数据类型。

跨站请求伪造，即 CSRF（cross-site request forgery，读作 sea-surf），是一种利用站点对用户浏览器信任而发起攻击的方式。



第 5 章　JSON中的安全问题

5.3　注入攻击

5.3.1　跨站脚本攻击

跨站脚本攻击（cross-site scripting，XSS）是注入攻击的一种。在使用 JSON 时常见的安全漏洞通常发生在 JavaScript 从服务器获取到一段 JSON 字符串并将其转化为 JavaScript 对象时。要知道，JSON 本身仅仅是文本。在编程中，如果想要对代表对象的文本进行操作，首先要将它转换成对象并装入内存中。这样，它才能被操作、观察，并在程序逻辑中使用。在 JavaScript 中，可以使用 eval() 函数来进行这一操作。该函数获取一段字符串，并对其进行编译与执行。



eval() 函数的问题是，它会将传入的字符串无差别地编译执行。如果从第三方服务器中获取的 JSON 被替换为了恶意脚本，那么我的站点就会无辜地蒙冤，在访问者的浏览器中编译执行恶意代码。随着 JSON 本身的不断发展，这一漏洞已得到公认。JSON.parse() 函数就是用来处理这一问题的。该函数仅会解析 JSON，并不会执行脚本。



Web 开发中还有一个和安全同等重要的问题，那就是跨浏览器兼容。

如何阻止这种情况呢？一方面，可以采取一些手段使得消息中不包含 HTML。可以在客户端和服务端都加上这一认证。此外，还可以将消息中所有的 HTML 字符进行转码，这样的话，诸如 <div> 这样的标签就会被转换成 <



在定位 JSON 安全问题时，应该记住以下三件事。

1). 不要使用顶级数组。顶级数组是合法的 JavaScript 脚本，它们可以用 <script> 标签链接并使用。

2). 对于不想公开的资源，仅允许使用 HTTP POST 方法请求，而不是 GET 方法。GET 方法可以通过 URL 来请求，甚至可以放在 <script> 标签中。

3). 使用 JSON.parse() 来代替 eval()。eval() 函数会将传入的字符串编译并执行，这会让你的代码易被攻击。应仅使用 JSON.parse() 来解析 JSON 数据。



第 6 章　JavaScript中的XMLHttpRequest与Web API

6.1　Web API

在 JavaScript 的异步操作中，主进程指 Web 浏览器的显示进程。

这里提到的 JavaScript 中的异步（后台）操作被称为 AJAX。AJAX 的全称是 Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。当在幕后请求 JSON 数据时，这从技术上讲可以被称为异步的 JavaScript 和 JSON（AJAJ）。然而，AJAX这个专有名词使用的时间已经很久了，所以很多时候，与其说它是一个首字母缩写，不如说是用来描述 JavaScript 中的任何一种异步操作。



6.2　JavaScript中的XMLHttpRequest对象

我们主要关注 XMLHttpRequest 中的以下这些可用的函数：

open（method，url，async（可选），user（可选），password（可选））

send()

以及下面这些属性：

onreadystatechange：可以在代码中给它赋值为一个函数（属性的函数值是一个时间处理函数。）

readyState：返回一个 0~4 的值，用来表示状态码

status：返回 HTTP 状态码（如 200 表示请求成功）

responseText：当请求成功时，该属性会包含作为文本的响应体（如我们请求的 JSON）



属性的值可以是一个函数。因为 JavaScript 中的函数也是一类对象。对象是一类数据，因此它可以被赋值给一个变量（属性）、修改和传递。在编程中，这种情况称为函数是一等公民。onreadystatechange 的值应该是一个函数。



序列化是将对象转换成文本的过程，反序列化是将文本转换成对象的过程。

JSON.parse() 进行反序列化操作。

 JSON.stringify() 对 JSON 进行序列化。



onreadystatechange 属性的函数值是一个时间处理函数。

0 表示未发送， open() 函数还没有执行

1 表示已发送，open() 函数已执行，但 send() 函数还没有执行

2 表示接收到头部，表示 send() 函数已执行且头部和状态码都可以获取了

3 表示解析中，表示头部已经收到，但响应体正在解析中

4 表示完成，表示请求完成，包括响应头和响应体的内容都已经接收到了



6.3　混乱的关系与共享的规则



有些开发人员可以连续多年通过 JavaScript 的 AJAX 技术向公共 API 发送请求，而不会受到同源策略的影响。这是因为这些公共 API 的开发者在他们的服务器上实现了跨域资源共享（cross-origin resource sharing，CORS）。这些服务器会在响应头额外加上一些带有 Access-Control-Allow 前缀的属性（示例 6-8）。

Access-Control-Allow-Credentials:true

Access-Control-Allow-Methods:GET, POST

Access-Control-Allow-Origin:*

本例中，此处包含一个星号（*）。它表示任意域名都是允许的



同源策略：出于安全的考虑，浏览器仅会请求同一个域的脚本。

跨域资源共享（CORS）：通过设置响应头，使得跨域请求资源（如 JSON 文档）可以成功。



第 7 章　JSON与客户端框架



这种节约时间、专注重点的框架在计算机科学中也被称为抽象化工具。

通常情况下，他们被称为 JavaScript 库或工具包。它们都在复杂的系统和手头的任务之间创建了一个抽象层。它们大都提供了便于使用的 HTML 文档对象模型（document object model，DOM）操作方法，或是专注于创建成熟的客户端 Web 应用程序。



7.1　jQuery和JSON

jQuery（http://jquery.com/）是一种允许开发者专注于操作 DOM 构建功能的抽象化工具。DOM 为我们和 HTML 页面产生交互提供了便利。在这一模型中，底层的 HTML 可以被当作具有许多可以枚举、获取和操作的字节点的对象来处理。



jQuery.parseJSON() 函数所起的作用远不是一行代码能说明的。如果研究 jQuery 库中对应的源码，会发现它会先尝试使用原生的 JSON.parse() 函数。如果浏览器不支持，它会使用和 eval() 功能类似的 new Function()。同时，它会对一些不合法的字符进行检测，如果发现其中有注入攻击的威胁，就会抛出错误。



7.2　AngularJS

jQuery 框架是为 DOM 操作服务的抽象化工具。AngularJS 框架（http://angularjs.org/）是专注于创建单页应用的抽象化工具。与传统的多页方式不同，单页 Web 应用致力于为用户提供无缝交互的应用体验。

jQuery 是一款提供了 JSON 请求和解析功能的能够缩短开发时间的抽象化工具。同时它还解决了跨浏览器兼容问题。



angular.module('myApp', [])

  .controller('myAppController', function(http) {

  $http.get('http://api.openweathermap.org/data/2.5/

   weather?lat=35&lon=139').

​    success(function(data, status, headers, config) {

​          $scope.weatherData = data;

​    });

});



第 8 章　JSON与NoSQL

8.3　专业术语和概念

关系型数据库：一种将存储的数据用可以辨识的关系进行结构化存储的数据库。

NoSQL 数据库：一种不通过存储数据间的关系来存储的数据库。

CouchDB：一种面向文档的 NoSQL 数据库存储类型，使用 JSON 文档的形式来存储数据。



在关系型数据库中，常常会存在表、列、行以及它们之间的关系，其中会用到主键和外键。

NoSQL 数据库有许多种，它们拥有与传统的关系型模型不同的数据存储与利用方法。



CouchDB，以下是需要记住的重点。

它是一种面向文档的 NoSQL 数据库。

它存储和管理 JSON 文档。

它会在存储与获取数据的同时维护好数据的结构。

它使用基于 HTTP 的 API 来获取作为 JSON 文档资源的数据。

它使用 JavaScript 作为查询语言，且通过视图的 map 和 reduce 方法来跨 API 获取数据。



由于多数系统都使用对象来为数据建模，所以 JSON 作为数据交换格式非常流行。